# wearableAnomaly

R tooling for ingesting continuous glucose monitor (CGM)–style signals,
spotting artifacts, and flagging changepoints in a reproducible
pipeline.

## Overview

- **Preprocess & validate**:
  [`toy_cgm()`](https://neokok.github.io/wearableAnomaly/reference/toy_cgm.md)
  provides tiny demo series;
  [`as_wearable_ts()`](https://neokok.github.io/wearableAnomaly/reference/as_wearable_ts.md)
  standardizes `<id, time, value>` data with bounds metadata;
  [`validate_ts()`](https://neokok.github.io/wearableAnomaly/reference/validate_ts.md)
  and
  [`resample_series()`](https://neokok.github.io/wearableAnomaly/reference/resample_series.md)
  clean and regularize inputs.
- **Artifact detectors**:
  [`detect_flatlines()`](https://neokok.github.io/wearableAnomaly/reference/detect_flatlines.md),
  [`detect_saturation()`](https://neokok.github.io/wearableAnomaly/reference/detect_saturation.md),
  and
  [`detect_rate_change()`](https://neokok.github.io/wearableAnomaly/reference/detect_rate_change.md)
  emit tidy episode tables (start/end/duration/type/strength) for common
  sensor glitches.
- **Changepoints**:
  [`detect_changepoints_pelt()`](https://neokok.github.io/wearableAnomaly/reference/detect_changepoints_pelt.md)
  (mean/variance or Poisson costs) and
  [`detect_changepoints_edivisive()`](https://neokok.github.io/wearableAnomaly/reference/detect_changepoints_edivisive.md)
  (energy-distance with permutations) surface structural shifts. Rcpp
  backends are selected automatically when compiled.
- **Pipeline**:
  [`detect_anomalies()`](https://neokok.github.io/wearableAnomaly/reference/detect_anomalies.md)
  orchestrates validation, optional resampling, detectors, changepoints,
  [`merge_segments()`](https://neokok.github.io/wearableAnomaly/reference/merge_segments.md),
  and
  [`score_anomalies()`](https://neokok.github.io/wearableAnomaly/reference/score_anomalies.md)
  to produce a unified table ready for benchmarking or plotting.
  [`evaluate_methods()`](https://neokok.github.io/wearableAnomaly/reference/evaluate_methods.md)
  compares predictions to truth labels when available.

## Installation

The package is not on CRAN. Install the development version from GitHub
with whichever helper you prefer:

``` r

# install.packages("pak")
pak::pak("neokok/wearableAnomaly")
```

or

``` r

install.packages("remotes")
remotes::install_github("neokok/wearableAnomaly")
```

## Quick start

``` r

library(dplyr)
library(wearableAnomaly)

# 1) Simulate one CGM-like subject and coerce to the wa_ts class
raw <- toy_cgm(n_id = 1, n = 96, by = "5 min", seed = 2025)
ts <- as_wearable_ts(raw, id = id, time = time, value = value)

# 2) Optional resampling (already 5 min cadence here, but shown for completeness)
ts5 <- resample_series(ts, by = "5 min", agg = "mean")

# 3) Run artifact and changepoint detectors
flat <- detect_flatlines(ts5, min_len = "20 min")
sat  <- detect_saturation(ts5, min_len = "15 min")
pelt <- detect_changepoints_pelt(ts5, penalty = "MBIC", min_seg_len = 12)

# 4) One-call pipeline with scoring
results <- detect_anomalies(ts, preset = "research", gap = "10 min")

# Peek at merged/scored segments
results$segments %>%
  select(id, start, end, source, subtype, score) %>%
  head()
```

The detectors all return tibbles, so you can
[`dplyr::arrange()`](https://dplyr.tidyverse.org/reference/arrange.html)/[`plot()`](https://rdrr.io/r/graphics/plot.default.html)/export
them directly or feed them into evaluation utilities.

## Documentation

- **Pkgdown site**: rebuildable HTML reference under
  [`docs/`](https://neokok.github.io/wearableAnomaly/docs/index.md).
- **Vignettes**: `vignettes/workflow.Rmd` for the end-to-end analysis
  and `vignettes/rcpp-comparison.Rmd` for R vs. Rcpp backend details.
- **Benchmarks**: `bench/bench_pelt.R` contains the interactive PELT
  timing script; expanded benchmark articles (including speed/accuracy
  tables) live or will live under `docs/articles/`.
- **GenAI tutorial**: Read the
  [`GenAI workflow tutorial`](https://neokok.github.io/wearableAnomaly/articles/genai-tutorial.html)
  for the exact prompts, tooling, screenshots, and lessons learned from
  building the package with AI assistance; the underlying source lives
  in `vignettes/genai-tutorial.Rmd`.

## Function reference (current exports)

| Category | Functions |
|----|----|
| Preprocess/check | [`toy_cgm()`](https://neokok.github.io/wearableAnomaly/reference/toy_cgm.md), [`as_wearable_ts()`](https://neokok.github.io/wearableAnomaly/reference/as_wearable_ts.md), [`validate_ts()`](https://neokok.github.io/wearableAnomaly/reference/validate_ts.md), [`has_issues()`](https://neokok.github.io/wearableAnomaly/reference/validate_ts.md), [`resample_series()`](https://neokok.github.io/wearableAnomaly/reference/resample_series.md) |
| Artifact detectors | [`detect_flatlines()`](https://neokok.github.io/wearableAnomaly/reference/detect_flatlines.md), [`detect_saturation()`](https://neokok.github.io/wearableAnomaly/reference/detect_saturation.md), [`detect_rate_change()`](https://neokok.github.io/wearableAnomaly/reference/detect_rate_change.md) |
| Changepoints | [`detect_changepoints_pelt()`](https://neokok.github.io/wearableAnomaly/reference/detect_changepoints_pelt.md), [`detect_changepoints_edivisive()`](https://neokok.github.io/wearableAnomaly/reference/detect_changepoints_edivisive.md) (with automatic R / Rcpp backends) |
| Pipeline helpers | [`merge_segments()`](https://neokok.github.io/wearableAnomaly/reference/merge_segments.md), [`score_anomalies()`](https://neokok.github.io/wearableAnomaly/reference/score_anomalies.md), [`detect_anomalies()`](https://neokok.github.io/wearableAnomaly/reference/detect_anomalies.md) |
| Evaluation | [`evaluate_methods()`](https://neokok.github.io/wearableAnomaly/reference/evaluate_methods.md) |

All detector outputs follow a consistent tidy schema, making it
straightforward to merge them, compute benchmarks, and reproduce the
“speed & accuracy” tables from the final presentation.

## Future work

For later exploration (not part of this release):

- Richer simulators that go beyond
  [`toy_cgm()`](https://neokok.github.io/wearableAnomaly/reference/toy_cgm.md)/[`simulate_cgm_benchmark()`](https://neokok.github.io/wearableAnomaly/reference/simulate_cgm_benchmark.md)
  (e.g., multi-day truth grids).
- Higher-level summaries of anomaly runs for reporting dashboards.
- Additional visualization sugar (e.g., reusable overlay helpers) to
  complement the custom ggplot code shown in the vignette.

## Contributing

Issues and pull requests are welcome. Please open a ticket if you run
into installation problems or have ideas for additional detectors,
simulators, or tutorials.

# Package index

## Package overview

- [`wearableAnomaly`](https://neokok.github.io/wearableAnomaly/reference/wearableAnomaly-package.md)
  [`wearableAnomaly-package`](https://neokok.github.io/wearableAnomaly/reference/wearableAnomaly-package.md)
  : wearableAnomaly: Tools for Wearable Device Anomaly Detection

## Preprocessing & validation

- [`as_wearable_ts()`](https://neokok.github.io/wearableAnomaly/reference/as_wearable_ts.md)
  : Coerce data into a wearable-anomaly time series tibble
- [`validate_ts()`](https://neokok.github.io/wearableAnomaly/reference/validate_ts.md)
  [`has_issues()`](https://neokok.github.io/wearableAnomaly/reference/validate_ts.md)
  : Validate a wearable-anomaly time series object
- [`resample_series()`](https://neokok.github.io/wearableAnomaly/reference/resample_series.md)
  : Resample a wearable time series onto an even cadence

## Artifact detectors

- [`detect_flatlines()`](https://neokok.github.io/wearableAnomaly/reference/detect_flatlines.md)
  : Detect flatline segments in a wearable time series
- [`detect_saturation()`](https://neokok.github.io/wearableAnomaly/reference/detect_saturation.md)
  : Detect saturation segments in a wearable time series
- [`detect_rate_change()`](https://neokok.github.io/wearableAnomaly/reference/detect_rate_change.md)
  : Detect rate-of-change anomalies in a wearable time series

## Changepoint detectors

- [`detect_changepoints_pelt()`](https://neokok.github.io/wearableAnomaly/reference/detect_changepoints_pelt.md)
  : Detect changepoints in wearable signals using the PELT algorithm
- [`detect_changepoints_edivisive()`](https://neokok.github.io/wearableAnomaly/reference/detect_changepoints_edivisive.md)
  : Detect changepoints with the E-divisive algorithm

## Pipeline & scoring

- [`detect_anomalies()`](https://neokok.github.io/wearableAnomaly/reference/detect_anomalies.md)
  : High-level anomaly detection pipeline
- [`merge_segments()`](https://neokok.github.io/wearableAnomaly/reference/merge_segments.md)
  : Merge heterogeneous anomaly detections
- [`score_anomalies()`](https://neokok.github.io/wearableAnomaly/reference/score_anomalies.md)
  : Score merged anomaly segments

## Evaluation & simulation

- [`evaluate_methods()`](https://neokok.github.io/wearableAnomaly/reference/evaluate_methods.md)
  : Evaluate predicted anomaly segments
- [`toy_cgm()`](https://neokok.github.io/wearableAnomaly/reference/toy_cgm.md)
  : Generate a small synthetic CGM-like data set
- [`simulate_cgm_benchmark()`](https://neokok.github.io/wearableAnomaly/reference/simulate_cgm_benchmark.md)
  : Simulate CGM benchmark series with ground-truth changepoints

# Articles

### Workflow

- [End-to-End Wearable Anomaly
  Workflow](https://neokok.github.io/wearableAnomaly/articles/workflow.md):

### Backends & benchmarks

- [Comparing R and Rcpp
  Implementations](https://neokok.github.io/wearableAnomaly/articles/rcpp-comparison.md):

### GenAI workflow

- [GenAI Workflow for
  wearableAnomaly](https://neokok.github.io/wearableAnomaly/articles/genai-tutorial.md):
